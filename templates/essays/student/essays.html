{% extends "base.html" %}

{% block title %}My Essays - AI Essay Coach{% endblock %}

{% block content %}
<div class="container-fluid">
    <div class="row">
        <!-- Sidebar Navigation -->
        <div class="col-lg-3 col-md-4 mb-4">
            <div class="card shadow-lg border-0 sticky-top" style="top: 110px;">
                <div class="card-header bg-gradient-primary text-white py-3">
                    <h5 class="mb-0 fw-bold d-flex align-items-center">
                        <i class="fas fa-compass me-3"></i>Navigation
                    </h5>
                </div>
                <div class="list-group list-group-flush">
                    <a href="{% url 'essays:dashboard' %}" class="list-group-item list-group-item-action border-0 fw-medium">
                        <i class="fas fa-chart-line me-3" style="width: 20px;"></i>Dashboard
                    </a>
                    <a href="{% url 'essays:upload' %}" class="list-group-item list-group-item-action border-0 fw-medium">
                        <i class="fas fa-cloud-upload-alt me-3" style="width: 20px;"></i>Upload Essay
                    </a>
                    <a href="{% url 'essays:essays_list' %}" class="list-group-item list-group-item-action active border-0 fw-medium">
                        <i class="fas fa-file-alt me-3" style="width: 20px;"></i>My Essays
                    </a>
                    <a href="{% url 'assignments:student_assignments' %}" class="list-group-item list-group-item-action border-0 fw-medium">
                        <i class="fas fa-tasks me-3" style="width: 20px;"></i>Assignments
                    </a>
                    <a href="{% url 'essays:progress' %}" class="list-group-item list-group-item-action border-0 fw-medium">
                        <i class="fas fa-chart-bar me-3" style="width: 20px;"></i>Progress Analytics
                    </a>
                    <a href="{% url 'accounts:teacher_requests' %}" class="list-group-item list-group-item-action border-0 fw-medium" onclick="console.log('Teacher Requests clicked!'); return true;">
                        <i class="fas fa-bell me-3" style="width: 20px;"></i>Teacher Requests
                    </a>
                    <a href="{% url 'accounts:profile' %}" class="list-group-item list-group-item-action border-0 fw-medium">
                        <i class="fas fa-user-cog me-3" style="width: 20px;"></i>Profile
                    </a>
                </div>
            </div>
        </div>
        
        <!-- Main Content -->
        <div class="col-lg-9 col-md-8">
            <!-- Header -->
            <div class="d-flex justify-content-between align-items-center mb-4 animate-fade-in">
                <div>
                    <h2 class="fw-bold mb-2">My Essays üìù</h2>
                    <p class="text-secondary mb-0">View all your submitted essays and feedback</p>
                </div>
                <a href="{% url 'essays:upload' %}" class="btn btn-primary btn-lg shadow-lg">
                    <i class="fas fa-plus me-2"></i>New Essay
                </a>
            </div>

            <!-- Essays List -->
            <div class="card border-0 shadow-lg animate-scale-in">
                <div class="card-header bg-gradient-primary text-white py-3">
                    <h5 class="mb-0 fw-bold d-flex align-items-center">
                        <i class="fas fa-file-alt me-3"></i>All Essays ({{ essays|length }})
                    </h5>
                </div>
                <div class="card-body p-0">
                    {% if page_obj %}
                        <div class="table-responsive">
                            <table class="table table-hover mb-0">
                                <thead class="table-light">
                                    <tr>
                                        <th class="fw-bold">Title</th>
                                        <th class="fw-bold">Type</th>
                                        <th class="fw-bold">Submitted</th>
                                        <th class="fw-bold">AI Score</th>
                                        <th class="fw-bold">Status</th>
                                        <th class="fw-bold">Actions</th>
                                    </tr>
                                </thead>
                                <tbody>
                                    {% for submission in page_obj %}
                                        <tr>
                                            <td>
                                                <div>
                                                    <h6 class="mb-1 fw-bold">{{ submission.file_name|default:'Untitled Essay' }}</h6>
                                                    <small class="text-muted">
                                                        <i class="fas fa-edit me-1"></i>
                                                        Individual submission
                                                    </small>
                                                </div>
                                            </td>
                                            <td>
                                                <span class="badge bg-light text-dark px-2 py-1">
                                                    {{ submission.analysis.essay_type|title|default:'General' }}
                                                </span>
                                            </td>
                                            <td>
                                                <small class="text-muted">
                                                    {{ submission.submitted_at|date:'m/d/Y \a\t g:i A'|default:'N/A' }}
                                                </small>
                                            </td>
                                            <td>
                                                {% if submission.analysis.overall_score %}
                                                    <span class="badge rounded-pill px-3 py-2 fw-bold" 
                                                          style="background: {% if submission.analysis.overall_score >= 80 %}var(--success-gradient){% elif submission.analysis.overall_score >= 60 %}var(--warning-gradient){% else %}var(--error-gradient){% endif %};">
                                                        {{ submission.analysis.overall_score|floatformat:1 }}%
                                                    </span>
                                                    <div class="mt-1">
                                                        <small class="text-muted">
                                                            Content: {{ submission.analysis.content_score|floatformat:0|default:0 }} | 
                                                            Structure: {{ submission.analysis.structure_score|floatformat:0|default:0 }} | 
                                                            Clarity: {{ submission.analysis.clarity_score|floatformat:0|default:0 }} | 
                                                            Grammar: {{ submission.analysis.grammar_score|floatformat:0|default:0 }}
                                                        </small>
                                                    </div>
                                                {% else %}
                                                    <span class="badge bg-secondary rounded-pill px-3 py-2">
                                                        Analyzing...
                                                    </span>
                                                {% endif %}
                                            </td>
                                            <td>
                                                <div class="d-flex flex-column">
                                                    <span class="badge bg-info mb-1">
                                                        Analyzed
                                                    </span>
                                                    {% if submission.analysis.teacher_feedback %}
                                                        <span class="badge bg-success px-2 py-1">
                                                            <i class="fas fa-comment me-1"></i>Teacher Feedback Available
                                                        </span>
                                                    {% else %}
                                                        <span class="badge bg-secondary px-2 py-1">
                                                            <i class="fas fa-clock me-1"></i>Awaiting Feedback
                                                        </span>
                                                    {% endif %}
                                                </div>
                                            </td>
                                            <td>
                                                <div class="btn-group-vertical btn-group-sm">
                                                    <a href="{% url 'essays:view_essay' analysis_id=submission.analysis.id %}" 
                                                       class="btn btn-outline-primary mb-1">
                                                        <i class="fas fa-eye me-1"></i>View Essay
                                                    </a>
                                                    {% if submission.analysis.teacher_feedback %}
                                                        <a href="#" 
                                                           class="btn btn-success">
                                                            <i class="fas fa-comment me-1"></i>View Teacher Feedback
                                                        </a>
                                                    {% else %}
                                                        <button class="btn btn-outline-secondary" disabled>
                                                            <i class="fas fa-clock me-1"></i>No Feedback Yet
                                                        </button>
                                                    {% endif %}
                                                </div>
                                            </td>
                                        </tr>
                                    {% endfor %}
                                </tbody>
                            </table>
                        </div>
                    {% else %}
                        <div class="text-center py-5">
                            <i class="fas fa-file-alt fa-3x text-muted mb-3"></i>
                            <h6 class="text-muted">No essays submitted yet</h6>
                            <p class="text-secondary">Upload your first essay to get started with AI feedback!</p>
                            <a href="{% url 'essays:upload' %}" class="btn btn-primary">
                                <i class="fas fa-plus me-2"></i>Upload Your First Essay
                            </a>
                        </div>
                    {% endif %}
                </div>
            </div>

            <!-- Summary Statistics -->
            {% if page_obj %}
                <div class="row g-4 mt-4">
                    <div class="col-md-3">
                        <div class="card border-0 shadow-sm h-100">
                            <div class="card-body text-center">
                                <div class="rounded-circle mx-auto mb-2 d-flex align-items-center justify-content-center" 
                                     style="width: 50px; height: 50px; background: var(--primary-gradient);">
                                    <i class="fas fa-file-alt text-white"></i>
                                </div>
                                <div class="fw-bold h5 mb-1">{{ page_obj.paginator.count }}</div>
                                <div class="text-muted small">Total Essays</div>
                            </div>
                        </div>
                    </div>
                    <div class="col-md-3">
                        <div class="card border-0 shadow-sm h-100">
                            <div class="card-body text-center">
                                <div class="rounded-circle mx-auto mb-2 d-flex align-items-center justify-content-center" 
                                     style="width: 50px; height: 50px; background: var(--success-gradient);">
                                    <i class="fas fa-chart-line text-white"></i>
                                </div>
                                <div class="fw-bold h5 mb-1">
                                    {% if average_score %}
                                        {{ average_score|floatformat:1 }}%
                                    {% else %}
                                        N/A
                                    {% endif %}
                                </div>
                                <div class="text-muted small">Average Score</div>
                            </div>
                        </div>
                    </div>
                    <div class="col-md-3">
                        <div class="card border-0 shadow-sm h-100">
                            <div class="card-body text-center">
                                <div class="rounded-circle mx-auto mb-2 d-flex align-items-center justify-content-center" 
                                     style="width: 50px; height: 50px; background: var(--info-gradient);">
                                    <i class="fas fa-comment text-white"></i>
                                </div>
                                <div class="fw-bold h5 mb-1">{{ essays_with_feedback_count }}</div>
                                <div class="text-muted small">With Feedback</div>
                            </div>
                        </div>
                    </div>
                    <div class="col-md-3">
                        <div class="card border-0 shadow-sm h-100">
                            <div class="card-body text-center">
                                <div class="rounded-circle mx-auto mb-2 d-flex align-items-center justify-content-center" 
                                     style="width: 50px; height: 50px; background: var(--warning-gradient);">
                                    <i class="fas fa-tasks text-white"></i>
                                </div>
                                <div class="fw-bold h5 mb-1">{{ assignment_context|length }}</div>
                                <div class="text-muted small">Assignments</div>
                            </div>
                        </div>
                    </div>
                </div>
            {% endif %}
        </div>
    </div>
</div>
{% endblock %}

{% block extra_css %}
<style>
.animate-fade-in {
    animation: fadeIn 0.6s ease-in;
}

.animate-scale-in {
    animation: scaleIn 0.5s ease-out;
}

.animate-slide-up {
    animation: slideUp 0.7s ease-out;
}

@keyframes fadeIn {
    from { opacity: 0; }
    to { opacity: 1; }
}

@keyframes scaleIn {
    from { transform: scale(0.95); opacity: 0; }
    to { transform: scale(1); opacity: 1; }
}

@keyframes slideUp {
    from { transform: translateY(20px); opacity: 0; }
    to { transform: translateY(0); opacity: 1; }
}
</style>
{% endblock %}
